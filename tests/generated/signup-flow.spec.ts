/**
 * Signup Flow Tests
 * 
 * Auto-generated by CodeGenerator Agent
 * Generated at: 2026-01-06T18:16:57.424Z
 * Risk Level: HIGH
 * 
 * Scenarios:
 *   - Signup with valid email and password (happy_path)
 *   - Signup with invalid email format (negative)
 *   - Signup with weak password (negative)
 *   - Signup with OTP verification (happy_path)
 *   - Signup with invalid OTP (negative)
 *   - Signup with SQL injection attempt (security)
 *   - Signup with cross-site scripting attempt (security)
 *   - Signup with edge case email format (edge_case)
 * 
 * DO NOT EDIT DIRECTLY - regenerate using the test planner
 */

import { test, expect } from '../../adapters';


const TEST_USER = {
  email: `test.${Date.now()}@example.com`,
  password: 'TestPassword123!',
  fullName: 'Test User',
  phone: '501234567',
  dob: { month: '0', year: '1990', day: '15' },
};

test.describe('Signup Flow', () => {

  test.beforeEach(async ({ supabaseAdapter }) => {
    // Clean up any existing test user
    console.log(`[Setup] Cleaning up test user: ${TEST_USER.email}`);
    await supabaseAdapter.deleteTestUser(TEST_USER.email);
  });

  test.afterEach(async ({ supabaseAdapter }) => {
    // Clean up test user after test
    await supabaseAdapter.deleteTestUser(TEST_USER.email);
  });


  test('Signup with valid email and password', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting: Signup with valid email and password');

    // Open signup modal
    await page.goto('/?action=signup');
    console.log('[Step 1] Open signup modal');

    // Wait for modal
    await expect(page.locator('[data-testid='signup-modal']')).toBeVisible({ timeout: 10000 });
    console.log('[Step 2] Wait for modal');

    // Enter email
    await page.locator('#login-email').fill('test@example.com');
    console.log('[Step 3] Enter email');

    // Enter password
    await page.locator('#login-password').fill('TestPassword123!');
    console.log('[Step 4] Enter password');

    // Click signup button
    await page.locator('[data-testid='signup-button']').click();
    console.log('[Step 5] Click signup button');

    // Assertions
    await expect(page.locator('[data-testid='signup-modal']')).toBeHidden({ timeout: 10000 });
    console.log('[Assert] Signup modal should close after success');

    await page.screenshot({ path: 'test-results/signup_valid_credentials.png' });
    console.log('[Test] Completed: Signup with valid email and password');
  });

  test('Signup with invalid email format', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting: Signup with invalid email format');

    // Open signup modal
    await page.goto('/?action=signup');
    console.log('[Step 1] Open signup modal');

    // Wait for modal
    await expect(page.locator('[data-testid='signup-modal']')).toBeVisible({ timeout: 10000 });
    console.log('[Step 2] Wait for modal');

    // Enter invalid email
    await page.locator('#login-email').fill('invalid_email');
    console.log('[Step 3] Enter invalid email');

    // Enter password
    await page.locator('#login-password').fill('TestPassword123!');
    console.log('[Step 4] Enter password');

    // Click signup button
    await page.locator('[data-testid='signup-button']').click();
    console.log('[Step 5] Click signup button');

    // Assertions
    await expect(page.locator('.text-red-400')).toBeVisible({ timeout: 10000 });
    console.log('[Assert] Error message should be displayed');

    await page.screenshot({ path: 'test-results/signup_invalid_email.png' });
    console.log('[Test] Completed: Signup with invalid email format');
  });

  test('Signup with weak password', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting: Signup with weak password');

    // Open signup modal
    await page.goto('/?action=signup');
    console.log('[Step 1] Open signup modal');

    // Wait for modal
    await expect(page.locator('[data-testid='signup-modal']')).toBeVisible({ timeout: 10000 });
    console.log('[Step 2] Wait for modal');

    // Enter email
    await page.locator('#login-email').fill('test@example.com');
    console.log('[Step 3] Enter email');

    // Enter weak password
    await page.locator('#login-password').fill('weak');
    console.log('[Step 4] Enter weak password');

    // Click signup button
    await page.locator('[data-testid='signup-button']').click();
    console.log('[Step 5] Click signup button');

    // Assertions
    await expect(page.locator('.text-red-400')).toBeVisible({ timeout: 10000 });
    console.log('[Assert] Error message should be displayed');

    await page.screenshot({ path: 'test-results/signup_weak_password.png' });
    console.log('[Test] Completed: Signup with weak password');
  });

  test('Signup with OTP verification', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting: Signup with OTP verification');
    test.setTimeout(120000);


    // Open signup modal
    await page.goto('/?action=signup');
    console.log('[Step 1] Open signup modal');

    // Wait for modal
    await expect(page.locator('[data-testid='signup-modal']')).toBeVisible({ timeout: 10000 });
    console.log('[Step 2] Wait for modal');

    // Enter email
    await page.locator('#login-email').fill('test@example.com');
    console.log('[Step 3] Enter email');

    // Enter password
    await page.locator('#login-password').fill('TestPassword123!');
    console.log('[Step 4] Enter password');

    // Click signup button
    await page.locator('[data-testid='signup-button']').click();
    console.log('[Step 5] Click signup button');

    // Enter OTP
    await page.locator('input[maxlength='1']').fill('123456');
    console.log('[Step 6] Enter OTP');

    // Assertions
    await expect(page.locator('[data-testid='signup-modal']')).toBeHidden({ timeout: 10000 });
    console.log('[Assert] Signup modal should close after success');

    await page.screenshot({ path: 'test-results/signup_otp_verification.png' });
    console.log('[Test] Completed: Signup with OTP verification');
  });

  test('Signup with invalid OTP', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting: Signup with invalid OTP');
    test.setTimeout(120000);


    // Open signup modal
    await page.goto('/?action=signup');
    console.log('[Step 1] Open signup modal');

    // Wait for modal
    await expect(page.locator('[data-testid='signup-modal']')).toBeVisible({ timeout: 10000 });
    console.log('[Step 2] Wait for modal');

    // Enter email
    await page.locator('#login-email').fill('test@example.com');
    console.log('[Step 3] Enter email');

    // Enter password
    await page.locator('#login-password').fill('TestPassword123!');
    console.log('[Step 4] Enter password');

    // Click signup button
    await page.locator('[data-testid='signup-button']').click();
    console.log('[Step 5] Click signup button');

    // Enter invalid OTP
    await page.locator('input[maxlength='1']').fill('123457');
    console.log('[Step 6] Enter invalid OTP');

    // Assertions
    await expect(page.locator('.text-red-400')).toBeVisible({ timeout: 10000 });
    console.log('[Assert] Error message should be displayed');

    await page.screenshot({ path: 'test-results/signup_invalid_otp.png' });
    console.log('[Test] Completed: Signup with invalid OTP');
  });

  test('Signup with SQL injection attempt', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting: Signup with SQL injection attempt');

    // Open signup modal
    await page.goto('/?action=signup');
    console.log('[Step 1] Open signup modal');

    // Wait for modal
    await expect(page.locator('[data-testid='signup-modal']')).toBeVisible({ timeout: 10000 });
    console.log('[Step 2] Wait for modal');

    // Enter email with SQL injection
    await page.locator('#login-email').fill('test@example.com OR 1=1');
    console.log('[Step 3] Enter email with SQL injection');

    // Enter password
    await page.locator('#login-password').fill('TestPassword123!');
    console.log('[Step 4] Enter password');

    // Click signup button
    await page.locator('[data-testid='signup-button']').click();
    console.log('[Step 5] Click signup button');

    // Assertions
    await expect(page.locator('.text-red-400')).toBeVisible({ timeout: 10000 });
    console.log('[Assert] Error message should be displayed');

    await page.screenshot({ path: 'test-results/signup_sql_injection.png' });
    console.log('[Test] Completed: Signup with SQL injection attempt');
  });

  test('Signup with cross-site scripting attempt', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting: Signup with cross-site scripting attempt');

    // Open signup modal
    await page.goto('/?action=signup');
    console.log('[Step 1] Open signup modal');

    // Wait for modal
    await expect(page.locator('[data-testid='signup-modal']')).toBeVisible({ timeout: 10000 });
    console.log('[Step 2] Wait for modal');

    // Enter email with cross-site scripting
    await page.locator('#login-email').fill('test@example.com<script>alert('XSS')</script>');
    console.log('[Step 3] Enter email with cross-site scripting');

    // Enter password
    await page.locator('#login-password').fill('TestPassword123!');
    console.log('[Step 4] Enter password');

    // Click signup button
    await page.locator('[data-testid='signup-button']').click();
    console.log('[Step 5] Click signup button');

    // Assertions
    await expect(page.locator('.text-red-400')).toBeVisible({ timeout: 10000 });
    console.log('[Assert] Error message should be displayed');

    await page.screenshot({ path: 'test-results/signup_cross_site_scripting.png' });
    console.log('[Test] Completed: Signup with cross-site scripting attempt');
  });

  test('Signup with edge case email format', async ({ page, supabaseAdapter }) => {
    console.log('[Test] Starting: Signup with edge case email format');

    // Open signup modal
    await page.goto('/?action=signup');
    console.log('[Step 1] Open signup modal');

    // Wait for modal
    await expect(page.locator('[data-testid='signup-modal']')).toBeVisible({ timeout: 10000 });
    console.log('[Step 2] Wait for modal');

    // Enter edge case email
    await page.locator('#login-email').fill('test+edgecase@example.com');
    console.log('[Step 3] Enter edge case email');

    // Enter password
    await page.locator('#login-password').fill('TestPassword123!');
    console.log('[Step 4] Enter password');

    // Click signup button
    await page.locator('[data-testid='signup-button']').click();
    console.log('[Step 5] Click signup button');

    // Assertions
    await expect(page.locator('[data-testid='signup-modal']')).toBeHidden({ timeout: 10000 });
    console.log('[Assert] Signup modal should close after success');

    await page.screenshot({ path: 'test-results/signup_edge_case_email.png' });
    console.log('[Test] Completed: Signup with edge case email format');
  });
});
